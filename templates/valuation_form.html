{% extends "base.html" %}

{% block title %}Property Valuation{% endblock %}

{% block header %}Property Valuation Form{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Property Valuation</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title mb-0">Property Valuation Form</h3>
            </div>
            <div class="card-body p-4">
                <p class="lead mb-4">
                    Enter your property details below to receive an accurate valuation using our advanced algorithms and GIS integration.
                </p>
                
                <form method="POST" action="{{ url_for('valuation') }}">
                    {{ form.csrf_token }}
                    
                    <div class="form-section">
                        <h4 class="form-section-title">Location Information</h4>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="{{ form.address.id }}" class="form-label">Address</label>
                                {{ form.address(class="form-control" + (" is-invalid" if form.address.errors else ""), placeholder="123 Main Street") }}
                                {% if form.address.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.address.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-5 mb-3">
                                <label for="{{ form.city.id }}" class="form-label">City</label>
                                {{ form.city(class="form-control" + (" is-invalid" if form.city.errors else ""), placeholder="Seattle") }}
                                {% if form.city.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.city.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="{{ form.state.id }}" class="form-label">State</label>
                                {{ form.state(class="form-control" + (" is-invalid" if form.state.errors else ""), placeholder="WA") }}
                                {% if form.state.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.state.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.zip_code.id }}" class="form-label">Zip Code</label>
                                {{ form.zip_code(class="form-control" + (" is-invalid" if form.zip_code.errors else ""), placeholder="98101") }}
                                {% if form.zip_code.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.zip_code.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="{{ form.neighborhood.id }}" class="form-label">Neighborhood (Optional)</label>
                                {{ form.neighborhood(class="form-control", placeholder="Downtown") }}
                                <div class="form-text">Enter your neighborhood name if known for improved accuracy.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">Property Characteristics</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.property_type.id }}" class="form-label">Property Type</label>
                                {{ form.property_type(class="form-select" + (" is-invalid" if form.property_type.errors else "")) }}
                                {% if form.property_type.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.property_type.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.bedrooms.id }}" class="form-label">Bedrooms</label>
                                {{ form.bedrooms(class="form-control" + (" is-invalid" if form.bedrooms.errors else ""), placeholder="3") }}
                                {% if form.bedrooms.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.bedrooms.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.bathrooms.id }}" class="form-label">Bathrooms</label>
                                {{ form.bathrooms(class="form-control" + (" is-invalid" if form.bathrooms.errors else ""), placeholder="2.5") }}
                                <div class="form-text">Include half baths as .5</div>
                                {% if form.bathrooms.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.bathrooms.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.year_built.id }}" class="form-label">Year Built</label>
                                {{ form.year_built(class="form-control" + (" is-invalid" if form.year_built.errors else ""), placeholder="2005") }}
                                {% if form.year_built.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.year_built.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.square_feet.id }}" class="form-label">Square Feet</label>
                                {{ form.square_feet(class="form-control" + (" is-invalid" if form.square_feet.errors else ""), placeholder="2000") }}
                                {% if form.square_feet.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.square_feet.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.lot_size.id }}" class="form-label">Lot Size (acres)</label>
                                {{ form.lot_size(class="form-control" + (" is-invalid" if form.lot_size.errors else ""), placeholder="0.25") }}
                                {% if form.lot_size.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.lot_size.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">Geolocation (Optional)</h4>
                        <p class="text-muted mb-3">
                            Enter latitude and longitude coordinates if known for enhanced GIS analysis.
                        </p>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.latitude.id }}" class="form-label">Latitude</label>
                                {{ form.latitude(class="form-control" + (" is-invalid" if form.latitude.errors else ""), placeholder="47.6062") }}
                                {% if form.latitude.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.latitude.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.longitude.id }}" class="form-label">Longitude</label>
                                {{ form.longitude(class="form-control" + (" is-invalid" if form.longitude.errors else ""), placeholder="-122.3321") }}
                                {% if form.longitude.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.longitude.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section mb-4">
                        <h4 class="form-section-title">Valuation Method</h4>
                        <p class="text-muted mb-3">
                            Select your preferred valuation method or use our recommended option.
                        </p>
                        <div class="row">
                            <div class="col-md-12">
                                {{ form.valuation_method(class="form-select" + (" is-invalid" if form.valuation_method.errors else "")) }}
                                {% if form.valuation_method.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.valuation_method.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        {{ form.submit(class="btn btn-primary btn-lg") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card shadow mb-4">
            <div class="card-header">
                <h3 class="card-title mb-0">Valuation Methods</h3>
            </div>
            <div class="card-body p-4">
                <div class="mb-3">
                    <h5>Enhanced Regression</h5>
                    <p class="text-muted small">Combines multiple models with market trend analysis. Recommended for most properties.</p>
                </div>
                
                <div class="mb-3">
                    <h5>LightGBM</h5>
                    <p class="text-muted small">Gradient boosting framework that uses tree-based algorithms. Handles categorical features efficiently.</p>
                </div>
                
                <div class="mb-3">
                    <h5>XGBoost</h5>
                    <p class="text-muted small">Extreme Gradient Boosting. Effective for identifying feature importance and handling complex relationships.</p>
                </div>
                
                <div class="mb-3">
                    <h5>Linear Regression</h5>
                    <p class="text-muted small">Basic model that assumes linear relationships between features. Simple but may lack accuracy for complex properties.</p>
                </div>
                
                <div class="mb-3">
                    <h5>Ridge Regression</h5>
                    <p class="text-muted small">Linear regression with L2 regularization. Good for when features are correlated.</p>
                </div>
                
                <div class="mb-3">
                    <h5>Lasso Regression</h5>
                    <p class="text-muted small">Linear regression with L1 regularization. Performs feature selection automatically.</p>
                </div>
                
                <div>
                    <h5>Elastic Net</h5>
                    <p class="text-muted small">Combination of Ridge and Lasso. Balances feature selection with handling correlated features.</p>
                </div>
            </div>
        </div>
        
        <div class="card shadow">
            <div class="card-header">
                <h3 class="card-title mb-0">Tips for Accuracy</h3>
            </div>
            <div class="card-body p-4">
                <ul class="mb-0">
                    <li class="mb-2">Provide as many details as possible</li>
                    <li class="mb-2">Include accurate square footage</li>
                    <li class="mb-2">Specify the exact neighborhood</li>
                    <li class="mb-2">Enter the correct property type</li>
                    <li>Add geolocation coordinates if available</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}